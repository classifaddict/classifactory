<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<script src="http://cdn.jsdelivr.net/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
	<link href="http://cdn.jsdelivr.net/jquery.fancytree/2.4.1/skin-win7/ui.fancytree.min.css" rel="stylesheet" type="text/css">
	<script src="http://cdn.jsdelivr.net/jquery.fancytree/2.4.1/jquery.fancytree-all.min.js"></script>
	<style type="text/css">
		body {
			font-family: Arial, Helvetica, sans-serif;
			font-size: 14px;
		}

		div#top {
			position:fixed;
			top:0px;
			left:0px;
			width:100%;
			color:#CCC;
			background:#333;
			padding:8px;
		}

		table {
			border-collapse: collapse;
			border-spacing: 0;
			margin-top: 80px;
		}
		td {
			vertical-align: top;
		}
		dl {
			margin: 0;
			padding: 0.1em 0 0 0;
		}
		dt {
			float: left;
			clear: left;
			display: none;
		}
		dt:after {
			content: ":";
		}
		dl.showattr dt {
			display: block;
		}
		dd {
			margin: 0 0 0 80px;
			padding: 0;
			display: none;
		}
		dd.main {
			font-weight: bold;
			display: block;
		}
		dl.showattr dd {
			display: block;
		}
		/*table.fancytree-ext-table tbody tr td {
			border: 0 none transparent;
		}*/
		ul.fancytree-container ul {
			padding: 0 0 0 0;
		}
	</style>
	<script>
	$(function(){
		$("#tree").fancytree({
	        source: {
	        url: "/tree/elements/fancy/roots/",
	        cache: false
	      },
	      lazyLoad: function(event, data){
		      var node = data.node;
		      data.result = {
		        url: "/tree/elements/fancy/" + node.key + "/",
		        cache: false
		      };
	      },
			activeVisible: true, // Make sure, active nodes are visible (expanded).
			//aria: true, // Enable WAI-ARIA support.
			autoActivate: true, // Automatically activate a node when it is focused (using keys).
			icons: false,
			debugLevel: 2, // 0:quiet, 1:normal, 2:debug
			extensions: ["table"],
			scrollParent: $(window),
			table: {
				indentation: 10,
				nodeColumnIdx: 0
			},
			renderColumns: function(event, data) {
				var node = data.node;
				$tdList = $(node.tr).find(">td");
				$tdList.eq(0).addClass("symbol");
				$tdList.eq(1).html(node.data.attrs);
				if (node.data.text) $tdList.eq(2).html(node.data.text);
				//if (node.data[1]) $tdList.eq(3).html(node.data[1].texts);
			},
			click: function(event, data) {
				// data.targetType is undefined when clicked column is not the main node one
				if (!data.targetType) {
					$tdList = $(data.node.tr).find(">td");
					$tdList.eq(1).find(">dl").toggleClass('showattr');
				}
			}
		});

		$("#search").submit(function(event) {
			var query = $("input").val();
			$.getJSON("/tree/elements/fancy/search/" + query + "/", function(data) {
				var tree = $("#tree").fancytree("getTree");
				reach_node(tree, data);
			});
			event.preventDefault();
		});

		$('#hideattrs').click(function() {
			$("dl").removeClass('showattr');
			var active = $("#tree").fancytree("getTree").getActiveNode();
			if (active){
				active.scrollIntoView();
			}
		});

		$('#showattrs').click(function() {
			$("dl").addClass('showattr');
			var active = $("#tree").fancytree("getTree").getActiveNode();
			if (active){
				active.scrollIntoView();
			}
		});

	});

	function reach_node(tree, path_keys) {
		var key = path_keys.pop();
		var node = tree.getNodeByKey(key.key);
		node.setExpanded(true).done(function(){
			if (path_keys.length==0) {
				node.setTitle('<b style="color: red;">'+node.title+'</b>');
				node.setActive();
				node.setFocus();
				node.scrollIntoView();
			} else {
				reach_node(tree, path_keys);
			}
		});
	}
	</script>
</head>
<body>
	<div id="top">
	<form id="search">
		<input type="text" name="query" size="100">
		<input type="submit" value="Search">
	</form><button id="showattrs">Show Attributes</button><button id="hideattrs">Hide Attributes</button>
	</div>
	<table id="tree" width="100%">
		<colgroup>
			<col style="width: 200px;">
			<col style="width: 200px;">
			<col style="width: 1*;">
			<col style="width: 1*;">
		</colgroup>
		<thead>
			<tr><th>ELEMENT</th> <th>ATTRIBUTES</th> <th>TEXT 1</th> <th>TEXT 2</th> </tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</body>
</html>